rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // REGRAS DE DESENVOLVIMENTO (MODO MASTER)
    // Versão de Sincronização Forçada: 1.0.6
    // Permite leitura e escrita em QUALQUER documento para usuários autenticados.
    
    match /{document=**} {
      allow read, write: if request.auth != null;
    }

    // Regras explícitas com seletor recursivo para coleções críticas
    // Isso garante que o método 'list' funcione sem ambiguidades
    
    match /lives/{allPaths=**} {
      allow read, write: if request.auth != null;
    }

    match /notices/{allPaths=**} {
      allow read, write: if request.auth != null;
    }

    match /teachers/{allPaths=**} {
      allow read, write: if request.auth != null;
    }
    
    match /learning_trails/{allPaths=**} {
      allow read, write: if request.auth != null;
    }
    
    match /users/{allPaths=**} {
      allow read, write: if request.auth != null;
    }

    match /chat_messages/{allPaths=**} {
      allow read, write: if request.auth != null;
    }

    match /library_resources/{allPaths=**} {
      allow read, write: if request.auth != null;
    }
    
    match /quiz_submissions/{allPaths=**} {
      allow read, write: if request.auth != null;
    }
  }
}